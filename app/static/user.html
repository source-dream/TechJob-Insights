<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <link rel="icon" href="https://cdn.sourcedream.cn/dist/img/favicon-32x32.png" sizes="32x32" type="image/png">
  <link rel="icon" href="https://cdn.sourcedream.cn/dist/img/favicon-16x16.png" sizes="16x16" type="image/png">
  <link rel="stylesheet" href="https://cdn.sourcedream.cn/lib/bootstrap-icons/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdn.sourcedream.cn/lib/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.sourcedream.cn/lib/bootstrap-table/dist/bootstrap-table.min.css">
  <link rel="stylesheet" href="https://cdn.sourcedream.cn/lib/bootstrap-table/dist/extensions/fixed-columns/bootstrap-table-fixed-columns.min.css">
  <link rel="stylesheet" href="https://cdn.sourcedream.cn/lib/@eonasdan/tempus-dominus/dist/css/tempus-dominus.min.css"/>
  <link rel="stylesheet" href="https://cdn.sourcedream.cn/lib/bootstrap-select/dist/css/bootstrap-select.min.css">
  <link rel="stylesheet" href="https://cdn.sourcedream.cn/dist/css/bootstrap-admin.min.css">
</head>
<body class="bg-body-tertiary py-3">
  <div class="container-fluid">
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <div id="toolbar" class="d-flex flex-wrap gap-2 mb-2">
          <button class="btn btn-light add-btn"><i
            class="bi bi-plus"></i> 新增
          </button>
          <!-- <button class="btn btn-light batch-btn" disabled><i class="bi bi-trash"></i> 批量删除</button>
          <button class="btn btn-light"><i class="bi bi-box-arrow-down"></i> 导入</button>
          <button class="btn btn-light"><i class="bi bi-box-arrow-up"></i> 导出</button> -->
        </div>
        <table id="table"></table>
      </div>
    </div>
  </div>
  <a href="javaScript:" class="bsa-back-to-top"><i class='bi bi-arrow-up-short'></i></a>
  <script src="https://cdn.sourcedream.cn/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.sourcedream.cn/lib/jquery/dist/jquery.min.js"></script>
  <script src="https://cdn.sourcedream.cn/lib/@popperjs/core/dist/umd/popper.min.js"></script>
  <script src="https://cdn.sourcedream.cn/lib/@eonasdan/tempus-dominus/dist/js/tempus-dominus.min.js"></script>
  <script src="https://cdn.sourcedream.cn/lib/bootstrap-table/dist/bootstrap-table.min.js"></script>
  <script src="https://cdn.sourcedream.cn/lib/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js"></script>
  <script src="https://cdn.sourcedream.cn/lib/bootstrap-table/dist/extensions/fixed-columns/bootstrap-table-fixed-columns.min.js"></script>
  <script src="https://cdn.sourcedream.cn/lib/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
  <script src="https://cdn.sourcedream.cn/lib/bootstrap-select/dist/js/i18n/defaults-zh_CN.min.js"></script>
  <script src="https://cdn.sourcedream.cn/dist/js/bootstrap-admin.min.js"></script>
  <script src="https://cdn.sourcedream.cn/dist/js/app.js"></script>
  <script>
    $(document).ready(function (e) {
      // 新增用户
      $('.add-btn').on('click', function () {
        // window.modalInstance = $.modal({
        //   url: 'user-add.html',
        //   title: '用户添加',
        //   buttons: [],
        //   modalDialogClass: 'modal-dialog-centered modal-lg',
        //   onHidden: function (obj, data) {
        //     if (data === true) {
        //       $('#table').bootstrapTable('refresh');
        //       $('#table').bootstrapTable('selectPage', 1)
        //     }
        //   }
        // })
      })
      $('#table').bootstrapTable({
        locale: 'zh-CN',
        url: '/user',
        responseHandler: function (res) {
          console.log(res.data)
          return res.data;
        },
        //固定列功能开启
        fixedColumns: true,
        //左侧固定列数
        fixedNumber: 1,
        //右侧固定列数
        fixedRightNumber: 1,
        //是否开启分页
        pagination: true,
        //是客户端分页还是服务端分页  'client','server',由于演示没有后端提供服务，所以采用前端分页演示
        sidePagination: 'client',
        // 初始化加载第一页，默认第一页
        pageNumber: 1,
        //默认显示几条
        pageSize: 5,
        //可供选择的每页的行数 - (亲测大于1000存在渲染问题)
        pageList: [5, 10, 25, 50, 100],
        //在上百页的情况下体验较好 - 能够显示首尾页
        paginationLoop: true,
        // 展示首尾页的最小页数
        paginationPagesBySide: 2,
        // 唯一ID字段
        uniqueId: 'id',
        // 每行的唯一标识字段
        idField: 'id',
        // 是否启用点击选中行
        clickToSelect: true,
        // 是否显示详细视图和列表视图的切换按钮
        showToggle: true,
        // 请求得到的数据类型
        dataType: 'json',
        // 请求方法
        method: 'get',
        // 工具按钮容器
        toolbar: '#toolbar',
        // 是否显示所有的列
        showColumns: true,
        // 是否显示刷新按钮
        showRefresh: true,
        // 显示图标
        showButtonIcons: true,
        // 显示文本
        showButtonText: false,
        // 显示全屏
        showFullscreen: false,
        // 开关控制分页
        showPaginationSwitch: false,
        // 总数字段
        totalField: 'total',
        // 当字段为 undefined 显示
        undefinedText: '-',
        // 排序方式
        // sortOrder: "asc",
        // 按钮的类
        buttonsClass: 'light',
        // 类名前缀
        buttonsPrefix: 'btn',
        // 图标前缀
        iconsPrefix: 'bi',
        // 图标大小 undefined sm lg
        iconSize: undefined,
        // 图标的设置
        icons: {
          fullscreen: 'bi-arrows-fullscreen',
        },
        //头部的那个复选框选中事件
        onCheckAll: function (row) {
          batchBtnStatusHandle()
        },
        //单行选中事件
        onCheck: function (row) {
          batchBtnStatusHandle()
        },
        //单行取消选中事件
        onUncheck: function (row) {
          batchBtnStatusHandle()
        },
        //头部的那个复选框取消选中事件
        onUncheckAll: function (row) {
          batchBtnStatusHandle()
        },
        //加载模板,不改的话，默认的会超出不好看
        loadingTemplate: function () {
          return '<div class="spinner-grow" role="status"><span class="visually-hidden">Loading...</span></div>';
        },
        onPostBody: function () {
          //重新启用弹出层,否则formatter格式化函数返回的html字符串上的tooltip提示不生效
          $('[data-bs-toggle="tooltip"]').each(function (i, el) {
            new bootstrap.Tooltip(el)
          })
        },
        columns: [
          {
            checkbox: true,
            visible: true,
          },
          {
            title: 'ID',
            field: 'id',
            align: 'center',
            sortable: true,
            width: 8,
            widthUnit: 'rem'
          },
          {
            title: '用户名',
            field: 'username',
            align: 'center'
          },
          {
            title: '邮箱',
            field: 'email',
            align: 'center',
          },
          {
            title: '密码',
            field: 'password',
            align: 'center',
            visible: false,
          },
          {
            title: '权限',
            field: 'auth',
            align: 'center',
          },
          {
            title: '操作',
            align: 'center',
            formatter: formatAction,
            events: {
              'click .edit-btn': function (event, value, row, index) {
              },
              'click .del-btn': function (event, value, row, index) {
              },  
              'click .role-btn': function (event, value, row, index) {
              }
            }
          }
        ]
      });
      //批量处理
      $('.batch-btn').on('click', function () {
        //获取所有选中行的id
        let id = [];
        let rowSelected = $("#table").bootstrapTable('getSelections');
        $.each(rowSelected, function (index, row) {
          id.push(row.id);
        })
        //发送ajax
        $.modal({
          body: '确定要删除所选用户吗?',
          ok: function () {
            $.ajax({
              url: '/user/10',
              method: 'delete',
              data: {id},
            }).then(response => {
              if (response.code === 200) {
                $.toasts({
                  type: 'success',
                  delay: 1500,
                  content: '删除成功',
                  onHidden: function () {
                    $('#table').bootstrapTable('refresh');
                    $('#table').bootstrapTable('selectPage', 1)//跳转到第一页
                    //把批量删除按钮变成禁止点击
                    $('.batch-btn').attr('disabled', true)
                  }
                })
              }
            });
          }
        })
      })
      //处理批量按钮的disabled状态
      function batchBtnStatusHandle() {
        let rowSelected = $("#table").bootstrapTable('getSelections');
        if (rowSelected.length > 0) {
          $('.batch-btn').attr('disabled', false)
        } else {
          $('.batch-btn').attr('disabled', true)
        }
      }

      //格式化列数据演示 val:当前数据 rows:当前整行数据
      function formatAction(val, rows) {
        let html = '';
        //第一个按钮(你可以在这里判断用户是否有修改权限来决定是否显示)
        html += `<button type="button" class="btn btn-light btn-sm edit-btn" data-bs-toggle="tooltip" data-bs-placement="top"
          data-bs-title="修改用户"><i class="bi bi-pencil"></i></button>`;
        //第二个按钮
        html += `<button type="button" class="btn btn-light mx-1 btn-sm del-btn" data-bs-toggle="tooltip" data-bs-placement="top"
          data-bs-title="删除用户"><i class="bi bi-trash3"></i></button>`
        //第三个按钮
        html += `<button type="button" class="btn btn-light btn-sm role-btn" data-bs-toggle="tooltip" data-bs-placement="top"
          data-bs-title="分配角色"><i class="bi bi-person-square"></i></button>`
        return html;
      }
      //搜索处理
      $('.bsa-querySearch-btn').on('click', function () {
        $('#table').bootstrapTable('refresh');
        $('#table').bootstrapTable('selectPage', 1)//跳转到第一页
      })
      //重置处理
      $('.bsa-reset-btn').on('click', function () {
        //把所有的字段都恢复默认值
        $('#username').val('');
        $('#phone').val('');
        $('#beginTime').val('');
        $('#endTime').val('');
        $('#status').val('0');
        //刷新回到第一页
        $('#table').bootstrapTable('refresh');
        $('#table').bootstrapTable('selectPage', 1)//跳转到第一页
      })
      //下拉框美化插件，原生的bootstrap它会调用系统的那个下拉菜单
      $('select').selectpicker();
    });
  </script>
</body>
</html>
